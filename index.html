<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CME Bitcoin Futures — Countdown (Dublin)</title>
  <link rel="icon" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTrC83h3hTxI-eUXaT0e7Tn0jeK-PJUKX4HEhlLvYNC3ZEq3oiSKRCdY0RN8ta3GjfIY-k&usqp=CAU" type="image/png">
  <style>
    body{
      font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;
      background:linear-gradient(135deg,#0f172a,#001219);
      color:#e6eef8;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100vh;
      margin:0;
      padding:20px;
    }
    .card{
      background:rgba(255,255,255,0.05);
      padding:28px;
      border-radius:16px;
      box-shadow:0 10px 30px rgba(2,6,23,0.6);
      max-width:480px;
      width:100%;
      text-align:center;
    }
    h1{margin:0 0 8px;font-size:22px;line-height:1.3}
    p.subtitle{margin:0 0 18px;color:#9fb0d9;font-size:14px}
    .big{font-size:42px;font-weight:700;letter-spacing:1px}
    .label{margin-top:10px;color:#bcd0f5;font-size:14px;word-break:break-word}
    .meta{margin-top:16px;color:#89a3d9;font-size:13px;text-align:left}
    .small{font-size:14px;color:#9fb0d9}
    .row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:16px}
    button{
      background:#1f6feb;
      border:0;
      padding:10px 14px;
      border-radius:10px;
      color:white;
      cursor:pointer;
      transition:background .2s;
      font-size:14px;
    }
    button:hover{background:#1552b5}
    footer{margin-top:16px;font-size:12px;color:#7f9bd6;text-align:center}

    @media(max-width:480px){
      .big{font-size:32px}
      h1{font-size:18px}
      .card{padding:20px}
    }

    /* Floating timer styles */
    #floatingTimer {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(15, 23, 42, 0.9);
      color: #fff;
      padding: 10px 16px;
      border-radius: 12px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.4);
      font-size: 18px;
      font-weight: 600;
      cursor: move;
      z-index: 9999;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>CME Bitcoin Futures — Next Transition</h1>
    <p class="subtitle">All times shown in <strong>Europe/Dublin</strong></p>

    <div id="event" class="small">Calculating...</div>
    <div id="countdown" class="big">--:--:--</div>
    <div id="targetLocal" class="label"></div>

    <div class="row">
      <button id="refresh">Refresh</button>
      <button id="copy">Copy Dublin Time</button>
    </div>

    <div class="meta">
      <strong>CME schedule used:</strong>
      <ul style="margin:8px 0 0;padding-left:18px;line-height:1.4">
        <li>Open: Sunday 18:00 ET</li>
        <li>Close: Friday 17:00 ET</li>
        <li>Daily break: 17:00–18:00 ET (daily)</li>
      </ul>
    </div>
    <footer>Uses IANA time zones — not reliant on your OS timezone setting.</footer>
  </div>

  <!-- Floating Timer -->
  <div id="floatingTimer">⏳ --:--:--</div>

  <script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>
  <script>
    const { DateTime } = luxon;
    const NY = 'America/New_York';
    const DUB = 'Europe/Dublin';

    function getNextTransition(nowNy){
      const dailyClose = nowNy.set({hour:17,minute:0,second:0,millisecond:0});
      const today18 = nowNy.set({hour:18,minute:0,second:0,millisecond:0});

      let fridayClose = nowNy.set({weekday:5,hour:17,minute:0,second:0,millisecond:0});
      if(fridayClose <= nowNy) fridayClose = fridayClose.plus({days:7});

      let sundayOpen = nowNy.set({weekday:7,hour:18,minute:0,second:0,millisecond:0});
      if(sundayOpen <= nowNy) sundayOpen = sundayOpen.plus({days:7});

      const lastFridayClose = fridayClose.minus({days:7});
      const nextSundayOpen = sundayOpen;

      if(nowNy >= lastFridayClose && nowNy < nextSundayOpen){
        return { state: 'CLOSED (weekend)', targetNy: nextSundayOpen };
      }

      if(nowNy >= dailyClose && nowNy < today18){
        return { state: 'DAILY BREAK', targetNy: today18 };
      }

      if(nowNy < dailyClose){
        return { state: 'OPEN', targetNy: dailyClose };
      } else {
        let next17 = dailyClose.plus({days:1});
        return { state: 'OPEN', targetNy: next17 };
      }
    }

    function update(){
      const nowNy = DateTime.now().setZone(NY);
      const nowDub = nowNy.setZone(DUB);
      const { state, targetNy } = getNextTransition(nowNy);
      const targetDub = targetNy.setZone(DUB);

      const diff = targetDub.diff(nowDub, ['days','hours','minutes','seconds']).toObject();

      const days = Math.floor(diff.days||0);
      const hours = Math.floor(diff.hours||0);
      const minutes = Math.floor(diff.minutes||0);
      const seconds = Math.floor(diff.seconds||0);

      const countdownText = (days>0? (days+'d '):'') + 
        `${String(hours).padStart(2,'0')}:${String(minutes).padStart(2,'0')}:${String(seconds).padStart(2,'0')}`;

      document.getElementById('event').innerHTML = `Market status: <strong>${state}</strong>`;
      document.getElementById('countdown').textContent = countdownText;
      document.getElementById('targetLocal').textContent = `Target time (Dublin): ${targetDub.toLocaleString(DateTime.DATETIME_FULL)} (${DUB})`;

      // update floating timer too
      document.getElementById('floatingTimer').textContent = "⏳ " + countdownText;

      document.querySelector('.card').style.border = state.includes('CLOSED') ? '1px solid rgba(255,80,80,0.2)' : '1px solid rgba(80,200,120,0.2)';
    }

    document.getElementById('refresh').addEventListener('click', update);
    document.getElementById('copy').addEventListener('click', ()=>{
      const txt = document.getElementById('targetLocal').textContent;
      navigator.clipboard?.writeText(txt).then(()=>{
        alert('Dublin target time copied to clipboard');
      }).catch(()=>{
        prompt('Copy this time', txt);
      });
    });

    update();
    setInterval(update, 1000);

    // make floating timer draggable
    const float = document.getElementById("floatingTimer");
    let offsetX, offsetY, dragging = false;

    float.addEventListener("mousedown", e => {
      dragging = true;
      offsetX = e.clientX - float.offsetLeft;
      offsetY = e.clientY - float.offsetTop;
    });

    document.addEventListener("mousemove", e => {
      if (!dragging) return;
      float.style.left = (e.clientX - offsetX) + "px";
      float.style.top = (e.clientY - offsetY) + "px";
      float.style.right = "auto";
      float.style.bottom = "auto";
    });

    document.addEventListener("mouseup", () => dragging = false);
  </script>
</body>
</html>
